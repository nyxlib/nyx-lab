/*--------------------------------------------------------------------------------------------------------------------*/

import * as uuid from 'uuid';

/*--------------------------------------------------------------------------------------------------------------------*/

import router from '../router';

import useConfigStore from '../stores/config';

/*--------------------------------------------------------------------------------------------------------------------*/

function _load(app, addonPath, addonName)
{
    /*----------------------------------------------------------------------------------------------------------------*/

    if(typeof window[addonName] === 'function') return Promise.resolve([app, addonName]);

    /*----------------------------------------------------------------------------------------------------------------*/

    return new Promise((resolve, reject) => {

        /*------------------------------------------------------------------------------------------------------------*/

        const script = document.createElement('script');

        script.addEventListener('load', () => {

            app.use(window[addonName].default);

            resolve(window[addonName].default);
        });

        script.addEventListener('error', () => {

            console.error(`Error loading addon ${addonName}`);

            reject(/*--------------*/ null /*--------------*/);
        });

        script.src = addonPath;

        script.async = true;

        /*------------------------------------------------------------------------------------------------------------*/

        document.head.appendChild(script);

        /*------------------------------------------------------------------------------------------------------------*/
    });

    /*----------------------------------------------------------------------------------------------------------------*/
}

/*--------------------------------------------------------------------------------------------------------------------*/

export default {

    install(app)
    {
        app.provide('addon', {
            /**/
            app: () => app,
            router: () => router,
            configStore: () => useConfigStore(),
            newId: () => uuid.v4(),
            /**/
            load: (addonPath, addonName) => _load(app, addonPath, addonName),
        });
    }
};

/*--------------------------------------------------------------------------------------------------------------------*/
